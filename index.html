<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clique Ella ;)</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .gradient-background {
      background: linear-gradient(180deg, rgba(255,208,229,1) 0%, rgba(255,232,242,1) 36%, rgba(255,255,255,1) 100%);
    }
    .bounce { animation: bounce 1.6s infinite; }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }

    button { touch-action: manipulation; -webkit-tap-highlight-color: transparent; }

    /* NO devient flottant */
    #noButton.escape {
      position: fixed !important;
      z-index: 9999;
    }
  </style>
</head>

<body class="gradient-background">
  <div class="flex items-center justify-center min-h-screen px-4">
    <div class="flex flex-col items-center w-full max-w-md py-10">

      <img
        id="imageDisplay"
        src="./1.jpeg"
        class="rounded-2xl h-[320px] w-full object-contain bg-white shadow-lg"
        alt="photo"
      />

      <h2
        id="valentineQuestion"
        class="text-3xl font-bold italic text-[#bd1e59] text-center mt-6"
      >
        Tu veux aller en date avec moi ce soir ? ðŸ™ƒ
      </h2>

      <div class="flex gap-4 mt-8 w-full" id="responseButtons">
        <button
          id="yesButton"
          class="bounce flex-1 bg-green-500 active:bg-green-400 text-white rounded-2xl px-6 py-4 text-xl shadow-md"
        >
          Oui mon bb d'amourðŸ’•
        </button>

        <button
          id="noButton"
          class="flex-1 bg-red-500 active:bg-red-600 text-white rounded-2xl px-6 py-4 text-xl shadow-md"
        >
          Non, tu pues le caca
        </button>
      </div>

      <p id="afterYes" class="hidden mt-6 text-lg text-[#bd1e59] font-semibold text-center"></p>
    </div>
  </div>

  <script type="module">
    import confetti from "https://cdn.skypack.dev/canvas-confetti";

    const yesButton = document.getElementById("yesButton");
    const noButton = document.getElementById("noButton");
    const imageDisplay = document.getElementById("imageDisplay");
    const valentineQuestion = document.getElementById("valentineQuestion");
    const responseButtons = document.getElementById("responseButtons");
    const afterYes = document.getElementById("afterYes");

    const imagePaths = ["./1.jpeg","./2.jpeg","./3.jpeg","./4.jpeg","./5.jpeg"];
    const texts = ["Non","T'es sÃ»re de toi ?ðŸ¤¨","Ella ?ðŸ˜¡","Je vais faire les gros yeux ðŸ‘€","Je pleure...ðŸ˜­", "J'arrive te tuer!ðŸ¤¬"];

    let noClickCount = 0;

    // Anti "mauvais clic" : on bloque YES pendant un court instant aprÃ¨s un NO
    let blockYesUntil = 0;

    function vibe(ms = 30) {
      if (navigator.vibrate) navigator.vibrate(ms);
    }

    function moveNoButton() {
      noButton.classList.add("escape");

      // Calcul basÃ© sur la taille rÃ©elle du bouton
      const rect = noButton.getBoundingClientRect();
      const padding = 16;

      const maxX = Math.max(padding, window.innerWidth - rect.width - padding);
      const maxY = Math.max(padding, window.innerHeight - rect.height - padding);

      const x = padding + Math.random() * (maxX - padding);
      const y = padding + Math.random() * (maxY - padding);

      noButton.style.left = `${x}px`;
      noButton.style.top = `${y}px`;
    }

    function handleNoAction(e) {
      // EmpÃªche que le navigateur "re-route" le touch vers un autre Ã©lÃ©ment (YES)
      e.preventDefault();
      e.stopPropagation();

      blockYesUntil = Date.now() + 450; // 450ms de "protection"
      vibe(40);

      if (noClickCount < imagePaths.length - 1) {
        noClickCount++;
        imageDisplay.src = imagePaths[noClickCount];
      }

      if (noClickCount < texts.length) {
        noButton.textContent = texts[noClickCount];
      }

      yesButton.style.transform = `scale(${1 + noClickCount * 0.25})`;

      // Le bouton fuit aprÃ¨s le "NO"
      moveNoButton();
    }

    // âœ… Un seul event qui marche bien sur mobile + desktop
    noButton.addEventListener("pointerdown", handleNoAction);

    // SÃ©curitÃ©: si certains navigateurs dÃ©clenchent quand mÃªme click
    noButton.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
    });

    yesButton.addEventListener("pointerdown", (e) => {
      // Si on vient de toucher NO, on ignore le YES accidentel
      if (Date.now() < blockYesUntil) {
        e.preventDefault();
        e.stopPropagation();
        return;
      }

      vibe(120);
      imageDisplay.src = "./coeur.jpeg";
      valentineQuestion.textContent = "Yesss ðŸ’– Jâ€™ai trop hÃ¢te !!!";
      responseButtons.style.display = "none";
      afterYes.textContent = "PrÃ©pare-toiâ€¦ Ã  toute bbyâœ¨";
      afterYes.classList.remove("hidden");

      confetti({ particleCount: 180, spread: 90, origin: { y: 0.6 } });
    });

    // Au chargement: place NO un peu plus bas pour Ã©viter les tap accidentels
    window.addEventListener("load", () => {
      // Optionnel : tu peux le laisser au milieu au dÃ©but
      // moveNoButton();
    });
  </script>
</body>
</html>
